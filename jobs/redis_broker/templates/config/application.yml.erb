<%
  master=link('redis_conn')
  if_link('master_conn'){ |x| master=x }
  slave=nil
  if_link('slave_conn'){ |x| slave=x }
  sentinel_master=nil
  if_link('redis_sentinel_conn') { |x| sentinel_master=x }
  if_link('redis_sentinel_master_conn') { |x| sentinel_master=x }
  sentinel_slave=nil
  if_link('redis_sentinel_slave_conn') { |x| sentinel_slave=x }
%>
server:
<% if p('bind') %>
  address: <%= spec.ip %>
<% else %>
  address: 127.0.0.1
<% end %>
  port: <%= p('port') %>
orange:
  redis:
    servers:
<%
  if !sentinel_master.nil?
    sentinel_master.instances.each do |x| %>
      - <%= x.address %>
<%  end
    if !sentinel_slave.nil?
      sentinel_slave.instances.each do |x| %>
      - <%= x.address %>
<%    end
    end
  else
    master.instances.each do |x| %>
      - <%= x.address %>
<%  end
    if !slave.nil?
      slave.instances.each do |x| %>
      - <%= x.address %>
<%    end
    end
  end %>
    port:
      <%= master.p('port') %>
<%
  master.if_p('password') do |password|
    unless password.to_s.empty? %>
    password: <%= password %>
<%  end
  end %>
<% if !sentinel_master.nil? %>
    sentinel:
      port: <%= sentinel_master.p('port') %>
<%
    sentinel_master.if_p('password') do |password|
      unless password.to_s.empty? %>
      password: <%= password %>
<%    end
    end
%>
      masterName: <%= spec.deployment %>
<% end %>
